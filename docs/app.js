!function(t){var e={};function s(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(o,i,function(e){return t[e]}.bind(null,i));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class o{constructor(t,e){t instanceof HTMLCanvasElement&&(this.context=t.getContext("2d")),t instanceof CanvasRenderingContext2D&&(this.context=t),this.data=e}updateFont(t){let e="";t.size&&(e+=t.size+"px"),t.family&&(e+=" "+t.family),this.context.font=e}updateFillStyle(t){t&&t.color&&(this.context.fillStyle=t.color)}}var i=function(t,e,s,o){return new(s||(s=Promise))((function(i,n){function r(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}h((o=o.apply(t,e||[])).next())}))};class n extends o{render(){return i(this,void 0,void 0,(function*(){const t=new Image;return t.src=this.data.src,new Promise((e,s)=>{t.addEventListener("load",()=>{this.data.srcCoords.size||(this.data.srcCoords.size={width:t.width,height:t.height}),this.data.destCoords.size||(this.data.destCoords.size=this.data.srcCoords.size),this.context.drawImage(t,this.data.srcCoords.pos.x,this.data.srcCoords.pos.y,this.data.srcCoords.size.width,this.data.srcCoords.size.height,this.data.destCoords.pos.x,this.data.destCoords.pos.y,this.data.destCoords.size.width,this.data.destCoords.size.height),e({success:!0,result:this.data.destCoords})}),t.addEventListener("error",t=>{s(t)})})}))}}class r{}class a extends r{}class h{constructor(t,e){this.pos=t,this.size=e}getSize(){return this.size||{height:0,width:0}}getLeftTopPos(){return this.pos}getLeftBottomPos(){return{x:this.pos.x,y:this.pos.y+this.getSize().height}}getRightTopPos(){return{x:this.pos.x+this.getSize().width,y:this.pos.y}}getRightBottomPos(){return{x:this.pos.x+this.getSize().width,y:this.pos.y+this.getSize().height}}getCenterPos(){return{x:this.pos.x+this.size.width/2,y:this.pos.y-this.size.height/2}}increaseX(t){return this.pos.x+=t,this}increaseY(t){return this.pos.y+=t,this}}class c{constructor(){this.closePath=!0,this.stroke=!0,this.fill=!1}}var d=function(t,e,s,o){return new(s||(s=Promise))((function(i,n){function r(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}h((o=o.apply(t,e||[])).next())}))};class u extends o{constructor(){super(...arguments),this.textRightAlign=!1}render(){return d(this,void 0,void 0,(function*(){this.updateFont(this.data.font),this.updateFillStyle(this.data.fill);const t=this.context.measureText(this.data.font.text).width;this.textRightAlign&&(this.data.pos.x-=t),this.context.fillText(this.data.font.text,this.data.pos.x,this.data.pos.y);const e={success:!0,result:new h(this.data.pos,{height:this.data.font.size,width:t})};return Promise.resolve(e)}))}}class l extends o{render(){return this.context.beginPath(),this.data.positions.forEach((t,e)=>{0===e?this.context.moveTo(t.x,t.y):this.context.lineTo(t.x,t.y)}),this.context.lineWidth=.5,this.context.strokeStyle="#333",this.data.closePath&&this.context.closePath(),this.data.stroke&&this.context.stroke(),this.data.fill&&this.context.fill(),Promise.resolve(new a)}}const f=document.querySelector("#canvas1").getContext("2d"),x=[];new Map;x.push(()=>new n(f,{src:"./resources/280TSI.jpg",srcCoords:new h({x:0,y:0}),destCoords:new h({x:0,y:0},{width:300,height:225})}).render()),x.push(t=>{return new n(f,{src:"http://vw.faw-vw.com/content/dam/vw-ngw/faw-vw/homepage/site_logo/pc_logo.png",srcCoords:new h({x:0,y:0}),destCoords:new h({x:10,y:8})}).render(),Promise.resolve(t)}),x.push(t=>{const e=t.result.getRightBottomPos(),s=new u(f,{pos:{x:e.x-5,y:e.y+12},font:{text:"大众 凌渡 280TSI DSG舒适版国VI",size:14,family:"sans-serif"}});return s.textRightAlign=!0,s.render()}),x.push(t=>{const e=t.result.getRightBottomPos(),s=new u(f,{pos:{x:e.x-50,y:e.y+15},font:{text:"12.46万",size:18,family:"sans-serif"},fill:{color:"red"}});return s.textRightAlign=!0,s.render()}),x.push(t=>{const e=t.result.getRightBottomPos();return new u(f,{pos:{x:250,y:e.y-t.result.size.height},font:{text:"18.00万",size:12,family:"sans-serif"},fill:{color:"gray"}}).render()}),x.push(t=>{const e=new c;return e.positions=[{x:250,y:t.result.getCenterPos().y+2},{x:295,y:t.result.getCenterPos().y+2}],new l(f,e).render()}),x.reduce((t,e)=>t.then(t=>e(t)),Promise.resolve(new a))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvcmUvQ29yZVJlbmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY29yZS9JbWFnZVJlbmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kZWxzL1JlbmRlclJlc3VsdC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kZWxzL0Nvb3JkaW5hdGVEYXRhLnRzIiwid2VicGFjazovLy8uL3NyYy9tb2RlbHMvRHJhd0xpbmUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvcmUvVGV4dFJlbmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY29yZS9MaW5lUmVuZGVyLnRzIiwid2VicGFjazovLy8uL3NyYy9hcHAudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJDb3JlUmVuZGVyIiwiZWxlbWVudCIsImRhdGEiLCJIVE1MQ2FudmFzRWxlbWVudCIsInRoaXMiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsIkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCIsImZvbnQiLCJzaXplIiwiZmFtaWx5IiwiZmlsbFN0eWxlIiwiY29sb3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsImltZyIsIkltYWdlIiwic3JjIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNyY0Nvb3JkcyIsIndpZHRoIiwiaGVpZ2h0IiwiZGVzdENvb3JkcyIsImRyYXdJbWFnZSIsInBvcyIsIngiLCJ5Iiwic3VjY2VzcyIsIlJlbmRlclJlc3VsdCIsIlJlbmRlckNvb3Jkc1Jlc3VsdCIsIkNvb3JkaW5hdGVEYXRhIiwic3RhcnQiLCJnZXRTaXplIiwiRHJhd0xpbmUiLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJmaWxsIiwic3VwZXIiLCJhcmd1bWVudHMiLCJ0ZXh0UmlnaHRBbGlnbiIsInVwZGF0ZUZvbnQiLCJ1cGRhdGVGaWxsU3R5bGUiLCJ0ZXh0V2lkdGgiLCJtZWFzdXJlVGV4dCIsInRleHQiLCJmaWxsVGV4dCIsImJlZ2luUGF0aCIsInBvc2l0aW9ucyIsImZvckVhY2giLCJpbmRleCIsIm1vdmVUbyIsImxpbmVUbyIsImxpbmVXaWR0aCIsInN0cm9rZVN0eWxlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmVuZGVycyIsIk1hcCIsInB1c2giLCJyZW5kZXIiLCJyZXNwb25zZSIsImdldFJpZ2h0Qm90dG9tUG9zIiwidGV4dFJlbmRlciIsImdldENlbnRlclBvcyIsInJlZHVjZSIsInByZXYiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtm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RCxLQUFNLFNBQVVsRCxLQUFNLEdBQUlDLE9BQVEsY0FDMUN5QyxLQUFNLENBQUV2QyxNQUFPLFNBR25CLE9BREFpRSxFQUFXdkIsZ0JBQWlCLEVBQ3JCdUIsRUFBV0gsV0FFdEJILEVBQVFFLEtBQU1FLElBQ1YsTUFBTXBDLEVBQU1vQyxFQUFTakQsT0FBT2tELG9CQU01QixPQUxtQixJQUFJLEVBQVd2RSxFQUFTLENBQ3ZDa0MsSUFBSyxDQUFFQyxFQUFHLElBQUtDLEVBQUdGLEVBQUlFLEVBQUlrQyxFQUFTakQsT0FBT2pCLEtBQUsyQixRQUMvQzVCLEtBQU0sQ0FBRW1ELEtBQU0sU0FBVWxELEtBQU0sR0FBSUMsT0FBUSxjQUMxQ3lDLEtBQU0sQ0FBRXZDLE1BQU8sVUFFRDhELFdBRXRCSCxFQUFRRSxLQUFLRSxJQUNULE1BQU16RSxFQUFPLElBQUk4QyxFQUtqQixPQUpBOUMsRUFBSzRELFVBQVksQ0FDYixDQUFFdEIsRUFBRyxJQUFLQyxFQUFHa0MsRUFBU2pELE9BQU9vRCxlQUFlckMsRUFBSSxHQUNoRCxDQUFFRCxFQUFHLElBQUtDLEVBQUdrQyxFQUFTakQsT0FBT29ELGVBQWVyQyxFQUFJLElBRTdDLElBQUksRUFBV3BDLEVBQVNILEdBQU13RSxXQVN6Q0gsRUFBUVEsT0FBTyxDQUFDQyxFQUFNekQsSUFDWHlELEVBQUtwRCxLQUFLK0MsR0FBWXBELEVBQUtvRCxJQUNuQ3pELFFBQVFDLFFBQVEsSUFBSXlCIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBjbGFzcyBDb3JlUmVuZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCBkYXRhKSB7XG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGVsZW1lbnQuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgfVxuICAgIHVwZGF0ZUZvbnQoZm9udCkge1xuICAgICAgICBsZXQgdmFsdWUgPSBcIlwiO1xuICAgICAgICBpZiAoZm9udC5zaXplKSB7XG4gICAgICAgICAgICB2YWx1ZSArPSBmb250LnNpemUgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvbnQuZmFtaWx5KSB7XG4gICAgICAgICAgICB2YWx1ZSArPSBcIiBcIiArIGZvbnQuZmFtaWx5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGV4dC5mb250ID0gdmFsdWU7XG4gICAgfVxuICAgIHVwZGF0ZUZpbGxTdHlsZShmaWxsU3R5bGUpIHtcbiAgICAgICAgaWYgKGZpbGxTdHlsZSAmJiBmaWxsU3R5bGUuY29sb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSBmaWxsU3R5bGUuY29sb3I7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCB7IENvcmVSZW5kZXIgfSBmcm9tIFwiLi9Db3JlUmVuZGVyXCI7XG5leHBvcnQgY2xhc3MgSW1hZ2VSZW5kZXIgZXh0ZW5kcyBDb3JlUmVuZGVyIHtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLmRhdGEuc3JjO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5zcmNDb29yZHMuc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhLnNyY0Nvb3Jkcy5zaXplID0geyB3aWR0aDogaW1nLndpZHRoLCBoZWlnaHQ6IGltZy5oZWlnaHQgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5kZXN0Q29vcmRzLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5kZXN0Q29vcmRzLnNpemUgPSB0aGlzLmRhdGEuc3JjQ29vcmRzLnNpemU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShpbWcsIHRoaXMuZGF0YS5zcmNDb29yZHMucG9zLngsIHRoaXMuZGF0YS5zcmNDb29yZHMucG9zLnksIHRoaXMuZGF0YS5zcmNDb29yZHMuc2l6ZS53aWR0aCwgdGhpcy5kYXRhLnNyY0Nvb3Jkcy5zaXplLmhlaWdodCwgdGhpcy5kYXRhLmRlc3RDb29yZHMucG9zLngsIHRoaXMuZGF0YS5kZXN0Q29vcmRzLnBvcy55LCB0aGlzLmRhdGEuZGVzdENvb3Jkcy5zaXplLndpZHRoLCB0aGlzLmRhdGEuZGVzdENvb3Jkcy5zaXplLmhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiB0cnVlLCByZXN1bHQ6IHRoaXMuZGF0YS5kZXN0Q29vcmRzIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJleHBvcnQgY2xhc3MgUmVuZGVyUmVzdWx0IHtcbn1cbmV4cG9ydCBjbGFzcyBSZW5kZXJDb29yZHNSZXN1bHQgZXh0ZW5kcyBSZW5kZXJSZXN1bHQge1xufVxuIiwiZXhwb3J0IGNsYXNzIENvb3JkaW5hdGVEYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihzdGFydCwgc2l6ZSkge1xuICAgICAgICB0aGlzLnBvcyA9IHN0YXJ0O1xuICAgICAgICB0aGlzLnNpemUgPSBzaXplO1xuICAgIH1cbiAgICBnZXRTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zaXplIHx8IHsgaGVpZ2h0OiAwLCB3aWR0aDogMCB9O1xuICAgIH1cbiAgICBnZXRMZWZ0VG9wUG9zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3M7XG4gICAgfVxuICAgIGdldExlZnRCb3R0b21Qb3MoKSB7XG4gICAgICAgIHJldHVybiB7IHg6IHRoaXMucG9zLngsIHk6IHRoaXMucG9zLnkgKyB0aGlzLmdldFNpemUoKS5oZWlnaHQgfTtcbiAgICB9XG4gICAgZ2V0UmlnaHRUb3BQb3MoKSB7XG4gICAgICAgIHJldHVybiB7IHg6IHRoaXMucG9zLnggKyB0aGlzLmdldFNpemUoKS53aWR0aCwgeTogdGhpcy5wb3MueSB9O1xuICAgIH1cbiAgICBnZXRSaWdodEJvdHRvbVBvcygpIHtcbiAgICAgICAgcmV0dXJuIHsgeDogdGhpcy5wb3MueCArIHRoaXMuZ2V0U2l6ZSgpLndpZHRoLCB5OiB0aGlzLnBvcy55ICsgdGhpcy5nZXRTaXplKCkuaGVpZ2h0IH07XG4gICAgfVxuICAgIGdldENlbnRlclBvcygpIHtcbiAgICAgICAgcmV0dXJuIHsgeDogdGhpcy5wb3MueCArICh0aGlzLnNpemUud2lkdGggLyAyKSwgeTogdGhpcy5wb3MueSAtICh0aGlzLnNpemUuaGVpZ2h0IC8gMikgfTtcbiAgICB9XG4gICAgaW5jcmVhc2VYKHZhbHVlKSB7XG4gICAgICAgIHRoaXMucG9zLnggKz0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBpbmNyZWFzZVkodmFsdWUpIHtcbiAgICAgICAgdGhpcy5wb3MueSArPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIERyYXdMaW5lIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jbG9zZVBhdGggPSB0cnVlO1xuICAgICAgICB0aGlzLnN0cm9rZSA9IHRydWU7XG4gICAgICAgIHRoaXMuZmlsbCA9IGZhbHNlO1xuICAgIH1cbn1cbiIsInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IHsgQ29vcmRpbmF0ZURhdGEgfSBmcm9tIFwiLi4vbW9kZWxzL2luZGV4XCI7XG5pbXBvcnQgeyBDb3JlUmVuZGVyIH0gZnJvbSBcIi4vQ29yZVJlbmRlclwiO1xuZXhwb3J0IGNsYXNzIFRleHRSZW5kZXIgZXh0ZW5kcyBDb3JlUmVuZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50ZXh0UmlnaHRBbGlnbiA9IGZhbHNlO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUZvbnQodGhpcy5kYXRhLmZvbnQpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVGaWxsU3R5bGUodGhpcy5kYXRhLmZpbGwpO1xuICAgICAgICAgICAgY29uc3QgdGV4dFdpZHRoID0gdGhpcy5jb250ZXh0Lm1lYXN1cmVUZXh0KHRoaXMuZGF0YS5mb250LnRleHQpLndpZHRoO1xuICAgICAgICAgICAgaWYgKHRoaXMudGV4dFJpZ2h0QWxpZ24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEucG9zLnggLT0gdGV4dFdpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmZpbGxUZXh0KHRoaXMuZGF0YS5mb250LnRleHQsIHRoaXMuZGF0YS5wb3MueCwgdGhpcy5kYXRhLnBvcy55KTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlc3VsdDogbmV3IENvb3JkaW5hdGVEYXRhKHRoaXMuZGF0YS5wb3MsIHtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmRhdGEuZm9udC5zaXplLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGV4dFdpZHRoXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENvcmVSZW5kZXIgfSBmcm9tIFwiLi9Db3JlUmVuZGVyXCI7XG5pbXBvcnQgeyBSZW5kZXJDb29yZHNSZXN1bHQgfSBmcm9tIFwiLi4vbW9kZWxzL2luZGV4XCI7XG5leHBvcnQgY2xhc3MgTGluZVJlbmRlciBleHRlbmRzIENvcmVSZW5kZXIge1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmRhdGEucG9zaXRpb25zLmZvckVhY2goKHBvcywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5tb3ZlVG8ocG9zLngsIHBvcy55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5saW5lVG8ocG9zLngsIHBvcy55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAwLjU7XG4gICAgICAgIHRoaXMuY29udGV4dC5zdHJva2VTdHlsZSA9IFwiIzMzM1wiO1xuICAgICAgICBpZiAodGhpcy5kYXRhLmNsb3NlUGF0aCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNsb3NlUGF0aCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRhdGEuc3Ryb2tlKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZGF0YS5maWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuZmlsbCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IFJlbmRlckNvb3Jkc1Jlc3VsdCgpKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBUZXh0UmVuZGVyLCBJbWFnZVJlbmRlciwgTGluZVJlbmRlciB9IGZyb20gXCIuL2NvcmUvaW5kZXhcIjtcbmltcG9ydCB7IENvb3JkaW5hdGVEYXRhLCBSZW5kZXJDb29yZHNSZXN1bHQsIERyYXdMaW5lIH0gZnJvbSBcIi4vbW9kZWxzL2luZGV4XCI7XG5jb25zdCBjYW52YXMxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYW52YXMxXCIpO1xuY29uc3QgY29udGV4dCA9IGNhbnZhczEuZ2V0Q29udGV4dChcIjJkXCIpO1xuY29uc3QgcmVuZGVycyA9IFtdO1xubGV0IHBvc2l0aW9ucyA9IG5ldyBNYXAoKTtcbnJlbmRlcnMucHVzaCgoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBJbWFnZVJlbmRlcihjb250ZXh0LCB7XG4gICAgICAgIHNyYzogXCIuL3Jlc291cmNlcy8yODBUU0kuanBnXCIsXG4gICAgICAgIHNyY0Nvb3JkczogbmV3IENvb3JkaW5hdGVEYXRhKHsgeDogMCwgeTogMCB9KSxcbiAgICAgICAgZGVzdENvb3JkczogbmV3IENvb3JkaW5hdGVEYXRhKHsgeDogMCwgeTogMCB9LCB7IHdpZHRoOiAzMDAsIGhlaWdodDogMjI1IH0pXG4gICAgfSkucmVuZGVyKCk7XG59KTtcbnJlbmRlcnMucHVzaCgocmVzcG9uc2UpID0+IHtcbiAgICBsZXQgcmVuZGVyID0gbmV3IEltYWdlUmVuZGVyKGNvbnRleHQsIHtcbiAgICAgICAgc3JjOiBcImh0dHA6Ly92dy5mYXctdncuY29tL2NvbnRlbnQvZGFtL3Z3LW5ndy9mYXctdncvaG9tZXBhZ2Uvc2l0ZV9sb2dvL3BjX2xvZ28ucG5nXCIsXG4gICAgICAgIHNyY0Nvb3JkczogbmV3IENvb3JkaW5hdGVEYXRhKHsgeDogMCwgeTogMCB9KSxcbiAgICAgICAgZGVzdENvb3JkczogbmV3IENvb3JkaW5hdGVEYXRhKHsgeDogMTAsIHk6IDggfSAvKiwge3dpZHRoOiA1MCwgaGVpZ2h0OiAzMH0qLylcbiAgICB9KTtcbiAgICByZW5kZXIucmVuZGVyKCk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG59KTtcbnJlbmRlcnMucHVzaCgocmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCBwb3MgPSByZXNwb25zZS5yZXN1bHQuZ2V0UmlnaHRCb3R0b21Qb3MoKTtcbiAgICBjb25zdCB0ZXh0UmVuZGVyID0gbmV3IFRleHRSZW5kZXIoY29udGV4dCwge1xuICAgICAgICBwb3M6IHsgeDogcG9zLnggLSA1LCB5OiBwb3MueSArIDEyIH0sXG4gICAgICAgIGZvbnQ6IHsgdGV4dDogXCLlpKfkvJcg5YeM5rihIDI4MFRTSSBEU0foiJLpgILniYjlm71WSVwiLCBzaXplOiAxNCwgZmFtaWx5OiBcInNhbnMtc2VyaWZcIiB9XG4gICAgfSk7XG4gICAgdGV4dFJlbmRlci50ZXh0UmlnaHRBbGlnbiA9IHRydWU7XG4gICAgcmV0dXJuIHRleHRSZW5kZXIucmVuZGVyKCk7XG59KTtcbnJlbmRlcnMucHVzaCgocmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCBwb3MgPSByZXNwb25zZS5yZXN1bHQuZ2V0UmlnaHRCb3R0b21Qb3MoKTtcbiAgICBjb25zdCB0ZXh0UmVuZGVyID0gbmV3IFRleHRSZW5kZXIoY29udGV4dCwge1xuICAgICAgICBwb3M6IHsgeDogcG9zLnggLSA1MCwgeTogcG9zLnkgKyAxNSB9LFxuICAgICAgICBmb250OiB7IHRleHQ6IFwiMTIuNDbkuIdcIiwgc2l6ZTogMTgsIGZhbWlseTogXCJzYW5zLXNlcmlmXCIgfSxcbiAgICAgICAgZmlsbDogeyBjb2xvcjogXCJyZWRcIiB9XG4gICAgfSk7XG4gICAgdGV4dFJlbmRlci50ZXh0UmlnaHRBbGlnbiA9IHRydWU7XG4gICAgcmV0dXJuIHRleHRSZW5kZXIucmVuZGVyKCk7XG59KTtcbnJlbmRlcnMucHVzaCgocmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCBwb3MgPSByZXNwb25zZS5yZXN1bHQuZ2V0UmlnaHRCb3R0b21Qb3MoKTtcbiAgICBjb25zdCB0ZXh0UmVuZGVyID0gbmV3IFRleHRSZW5kZXIoY29udGV4dCwge1xuICAgICAgICBwb3M6IHsgeDogMjUwLCB5OiBwb3MueSAtIHJlc3BvbnNlLnJlc3VsdC5zaXplLmhlaWdodCB9LFxuICAgICAgICBmb250OiB7IHRleHQ6IFwiMTguMDDkuIdcIiwgc2l6ZTogMTIsIGZhbWlseTogXCJzYW5zLXNlcmlmXCIgfSxcbiAgICAgICAgZmlsbDogeyBjb2xvcjogXCJncmF5XCIgfVxuICAgIH0pO1xuICAgIHJldHVybiB0ZXh0UmVuZGVyLnJlbmRlcigpO1xufSk7XG5yZW5kZXJzLnB1c2gocmVzcG9uc2UgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgRHJhd0xpbmUoKTtcbiAgICBkYXRhLnBvc2l0aW9ucyA9IFtcbiAgICAgICAgeyB4OiAyNTAsIHk6IHJlc3BvbnNlLnJlc3VsdC5nZXRDZW50ZXJQb3MoKS55ICsgMiB9LFxuICAgICAgICB7IHg6IDI5NSwgeTogcmVzcG9uc2UucmVzdWx0LmdldENlbnRlclBvcygpLnkgKyAyIH1cbiAgICBdO1xuICAgIHJldHVybiBuZXcgTGluZVJlbmRlcihjb250ZXh0LCBkYXRhKS5yZW5kZXIoKTtcbn0pO1xuLy8gcmVuZGVycy5wdXNoKHJlc3BvbnNlID0+IHtcbi8vICAgICBjb25zdCBkYXRhOiBEcmF3TGluZSA9IG5ldyBEcmF3TGluZSgpO1xuLy8gICAgIGRhdGEucG9zaXRpb25zID0gW3sgeDogMTAsIHk6IDIwIH0sIHsgeDogMTAsIHk6IDUwIH0sIHsgeDogNTAsIHk6IDUwIH1dO1xuLy8gICAgIGRhdGEuY2xvc2VQYXRoID0gZmFsc2U7XG4vLyAgICAgY29uc3QgbGluZVIgPSBuZXcgTGluZVJlbmRlcihjb250ZXh0LCBkYXRhKTtcbi8vICAgICByZXR1cm4gbGluZVIucmVuZGVyKCk7XG4vLyB9KTtcbnJlbmRlcnMucmVkdWNlKChwcmV2LCBuZXh0KSA9PiB7XG4gICAgcmV0dXJuIHByZXYudGhlbihyZXNwb25zZSA9PiBuZXh0KHJlc3BvbnNlKSk7XG59LCBQcm9taXNlLnJlc29sdmUobmV3IFJlbmRlckNvb3Jkc1Jlc3VsdCgpKSk7XG4iXSwic291cmNlUm9vdCI6IiJ9